(()=>{"use strict";const t={dice:"dices_42x42px_mixed_frames.png",board:"board.svg",pointerGreen:"pointer_green_132x132px.png",pointerRed:"pointer_red_132x132px.png",dicePointer:"dice_pointer_56x56px_15frames.png",tokenGreen:"token_green_128x128px.png",tokenYellow:"token_yellow_128x128px.png",tokenBlue:"token_blue_128x128px.png",tokenRed:"token_red_128x128px.png",tokenColor:"token_color_128x128px.png",tokenPurple:"token_purple_128x128px.png",tokenBlack:"token_black_128x128px.png"},e={dice:"se_dices.mp3",dice2:"se_dices.mp3"};class i{static instance;constructor(){if(i.instance)return i.instance;this.canvas=document.createElement("canvas"),this.width=this.canvas.width=innerWidth,this.height=this.canvas.height=innerHeight,this.x=Math.floor(this.width/2),this.y=Math.floor(this.height/2),this.context=this.canvas.getContext("2d"),document.body.append(this.canvas),this.layers=[],this.resizeDependenceArray=[],i.instance=this}resize(){this.width=this.canvas.width=innerWidth,this.height=this.canvas.height=innerHeight,this.x=Math.floor(this.width/2),this.y=Math.floor(this.height/2),this.resizeDependenceArray.forEach((t=>t.resize()))}}const s=new i;let h=performance.now(),a=!0;function r(t){const e=t-h;h=t,s.context.clearRect(0,0,s.width,s.height),s.layers.forEach((t=>t.update(e))),a&&requestAnimationFrame(r)}window.onblur=function(){a=!1},window.onfocus=function(){a||(a=!0,h=performance.now(),requestAnimationFrame(r))},window.onresize=s.resize.bind(s),requestAnimationFrame(r);const o=s;let n=0;const p=class{constructor(t="",e=o.layers.length,i=[]){this.name=t||"layer"+n++,this.zIndex=e,this.objects=i,e===o.layers.length?o.layers.push(this):(array.splice(e,0,this),o.layers.forEach(((t,e)=>t.zIndex=e)))}update(t){this.objects.forEach((e=>e.update(t)))}remove(t){this.objects=this.objects.filter((e=>e!==t))}add(t){this.objects.push(t)}clear(){this.objects=[]}},y=class{constructor(e,i){this.offsetViewX=e,this.offsetViewY=i,this.img=t.dice,this.resize(),this.frameSize=42,this.frameHalfSize=21,this.fps=30,this.frameDuration=Math.floor(1e3/this.fps),this.frameTimeout=this.frameDuration,this.framePathSize=30,this.framePath=[],this.value=this.getNewValue(),this.framePoint=this.getCoordinates(),this.framePoint.x*=this.frameSize,this.framePoint.y*=this.frameSize,o.resizeDependenceArray.push(this)}resize(){this.x=o.x+this.offsetViewX,this.y=o.y+this.offsetViewY}getNewValue(){return Math.ceil(6*Math.random())}getCoordinates(){switch(this.value){case 1:return{x:0,y:Math.random()<.5?4:12};case 2:return{x:4,y:Math.random()<.5?4:12};case 5:return{x:12,y:Math.random()<.5?4:12};case 6:return{x:8,y:Math.random()<.5?4:12};case 3:return{x:4*Math.floor(4*Math.random()),y:0};case 4:return{x:4*Math.floor(4*Math.random()),y:8}}}throw(){if(this.framePath.length)return 0;let t=(""+Math.random()).slice(2);for(;t.length<this.framePathSize;)t+=(""+Math.random()).slice(2);this.value=this.getNewValue();let{x:e,y:i}=this.getCoordinates();this.framePath.push({x:e,y:i});let s=Math.floor(8*Math.random());for(let h=1;h<t.length;h++)0!==s&&4!==s&&(e+=s<4?1:-1,e<0&&(e=15),e>15&&(e=0)),2!==s&&6!==s&&(i+=s>2&&s<6?1:-1,i<0&&(i=15),i>15&&(i=0)),this.framePath.push({x:e,y:i}),+t[h]<2&&(s--,s<0&&(s=7)),+t[h]>7&&(s++,s>7&&(s=0));return this.framePath.forEach((t=>{t.x*=this.frameSize,t.y*=this.frameSize})),this.value}update(t){this.framePath.length&&(this.frameTimeout-=t,this.frameTimeout<=0&&(this.frameTimeout+=this.frameDuration,this.framePoint=this.framePath.pop())),o.context.drawImage(this.img,this.framePoint.x,this.framePoint.y,this.frameSize,this.frameSize,this.x-this.frameHalfSize,this.y-this.frameHalfSize,this.frameSize,this.frameSize)}},l=class{constructor(t,e,i,s){this.image=t,this.board=i,this.container=i.ceils,this.index=6+12*e,this.stepDuration=400,this.steps=0,this.target=null,this.isOnPort=!1,this.resize(),this.next=s,o.resizeDependenceArray.push(this)}resize(){this.maxSize=this.board.ceilSize,this.minSize=.7*this.maxSize,this.size=this.minSize,this.halfSize=this.minSize/2,this.sizeRate=(this.maxSize-this.minSize)/this.stepDuration,this.stepRate=this.board.ceilSize/this.stepDuration,this.steps?this.finishStep():(this.x=this.container[this.index].x,this.y=this.container[this.index].y)}move(t){this.steps||(this.steps=t,this.updateTarget())}updateTarget(){if(0===this.steps){if(this.container===this.board.ceils&&"toilet"===this.container[this.index].type){let t;switch(this.steps++,this.container[this.index].target){case"toiletTop":t=this.board.toiletTop;break;case"toiletRight":t=this.board.toiletRight;break;case"toiletBottom":t=this.board.toiletBottom;break;case"toiletLeft":t=this.board.toiletLeft}return void(this.target={container:t,index:0,x:t[0].x,y:t[0].y})}if(this.container===this.board.ceils&&"port"===this.container[this.index].type){if(this.isOnPort)return this.isOnPort=!1,this.steps=0,this.target=null,void setTimeout((()=>this.next()),500);this.isOnPort=!0,this.steps++;let t=this.container[this.index].target;return void(this.target={container:this.container,index:t,x:this.container[t].x,y:this.container[t].y})}return this.target=null,void setTimeout((()=>this.next()),500)}if(this.container===this.board.toiletTop||this.container===this.board.toiletRight||this.container===this.board.toiletBottom||this.container===this.board.toiletLeft){if(console.log("in toilet"),0===this.index&&1!==this.steps)return this.steps=0,this.target=null,void setTimeout((()=>this.next()),500);if(1===this.index&&3!==this.steps)return this.steps=0,this.target=null,void setTimeout((()=>this.next()),500);if(2===this.index){if(6!==this.steps)return this.steps=0,this.target=null,void setTimeout((()=>this.next()),500);let t;switch(this.steps=1,this.container){case this.board.toiletTop:t=11;break;case this.board.toiletRight:t=23;break;case this.board.toiletBottom:t=35;break;case this.board.toiletLeft:t=47}return void(this.target={container:this.board.ceils,index:t,x:this.board.ceils[t].x,y:this.board.ceils[t].y})}}let t=this.index+1;t===this.container.length&&(t=0);const e=this.container;this.target={container:e,index:t,x:e[t].x,y:e[t].y}}finishStep(){this.steps--,this.container=this.target.container,this.index=this.target.index,this.x=this.target.x,this.y=this.target.y,this.size=this.minSize,this.halfSize=this.size/2,this.updateTarget()}update(t){if(this.steps){const e=this.target.x-this.x,i=this.target.y-this.y;if(this.isOnPort){const s=this.stepRate*t*2;this.x+=e>0?s:-s,this.y+=i>0?s:-s,e>0&&this.x>=this.target.x&&this.finishStep(),e<0&&this.x<=this.target.x&&this.finishStep()}else e>0?(this.x+=this.stepRate*t,this.x>=this.target.x?this.finishStep():e>this.minSize?this.size+=this.sizeRate*t:this.size-=this.sizeRate*t):e<0?(this.x-=this.stepRate*t,this.x<=this.target.x?this.finishStep():-e>this.minSize?this.size+=this.sizeRate*t:this.size-=this.sizeRate*t):i>0?(this.y+=this.stepRate*t,this.y>=this.target.y?this.finishStep():i>this.minSize?this.size+=this.sizeRate*t:this.size-=this.sizeRate*t):i<0?(this.y-=this.stepRate*t,this.y<=this.target.y?this.finishStep():-i>this.minSize?this.size+=this.sizeRate*t:this.size-=this.sizeRate*t):this.finishStep();this.halfSize=this.size/2}o.context.drawImage(this.image,this.x-this.halfSize,this.y-this.halfSize,this.size,this.size)}},c=class{constructor(e,i,s=!0){this.image=s?t.pointerGreen:t.pointerRed,this.target=e,this.board=i,this.scaleDuration=600,this.rotationSpeed=.002,this.resize(),this.direction=0,this.isScaleUp=!0,o.resizeDependenceArray.push(this)}resize(){this.maxSize=1.025*this.board.ceilSize,this.minSize=.9*this.maxSize,this.size=this.minSize,this.halfSize=this.size/2,this.scaleRate=(this.maxSize-this.minSize)/this.scaleDuration,this.x=this.target.x,this.y=this.target.y}update(t){this.direction+=this.rotationSpeed*t,this.isScaleUp?(this.size+=this.scaleRate*t,this.size>=this.maxSize&&(this.isScaleUp=!1)):(this.size-=this.scaleRate*t,this.size<=this.minSize&&(this.isScaleUp=!0)),this.halfSize=this.size/2,o.context.setTransform(1,0,0,1,this.x,this.y),o.context.rotate(this.direction),o.context.drawImage(this.image,-this.halfSize,-this.halfSize,this.size,this.size),o.context.setTransform(1,0,0,1,0,0)}},m=class{constructor(e){this.image=t.dicePointer,this.size=56,this.halfSize=this.size/2,this.dice=e,this.frame=0,this.fps=30,this.frameDuration=Math.floor(1e3/this.fps),this.frameTimeout=this.frameDuration,this.frames=this.getFrames(),this.resize(),o.resizeDependenceArray.push(this)}getFrames(){const t=[];for(let e=0;e<this.image.height;e+=this.size)for(let i=0;i<this.image.width;i+=this.size)t.push({x:i,y:e});return t}resize(){this.x=this.dice.x,this.y=this.dice.y}update(t){this.frameTimeout-=t,this.frameTimeout<=0&&(this.frameTimeout+=this.frameDuration,this.frame++,this.frame===this.frames.length&&(this.frame=0)),o.context.drawImage(this.image,this.frames[this.frame].x,this.frames[this.frame].y,this.size,this.size,this.x-this.halfSize,this.y-this.halfSize,this.size,this.size)}};!function(i){let s=Object.keys(t).length+Object.keys(e).length;for(const e in t){const i=new Image;i.src="./src/images/"+t[e],i.onload=()=>{t[e]=i,h()}}for(const t in e){const i=new Audio("./src/sounds/"+e[t]);i.oncanplaythrough=s=>{s.target.oncanplaythrough=null,e[t]=i,h()}}function h(){s--,s||function(){const e=new class{constructor(){this.image=t.board,this.layer=new p("board",0,[this]),this.toiletTop=[{type:"toilet",x:0,y:0,rateX:9,rateY:1},{type:"toilet",x:0,y:0,rateX:10,rateY:1},{type:"toilet",x:0,y:0,rateX:11,rateY:1}],this.toiletRight=[{type:"toilet",x:0,y:0,rateX:11,rateY:9},{type:"toilet",x:0,y:0,rateX:11,rateY:10},{type:"toilet",x:0,y:0,rateX:11,rateY:11}],this.toiletBottom=[{type:"toilet",x:0,y:0,rateX:3,rateY:11},{type:"toilet",x:0,y:0,rateX:2,rateY:11},{type:"toilet",x:0,y:0,rateX:1,rateY:11}],this.toiletLeft=[{type:"toilet",x:0,y:0,rateX:1,rateY:3},{type:"toilet",x:0,y:0,rateX:1,rateY:2},{type:"toilet",x:0,y:0,rateX:1,rateY:1}],this.homeTop=[{type:"home",x:0,y:0,rateX:6,rateY:1},{type:"home",x:0,y:0,rateX:6,rateY:2},{type:"home",x:0,y:0,rateX:6,rateY:3},{type:"home",x:0,y:0,rateX:6,rateY:4}],this.homeRight=[{type:"home",x:0,y:0,rateX:11,rateY:6},{type:"home",x:0,y:0,rateX:10,rateY:6},{type:"home",x:0,y:0,rateX:9,rateY:6},{type:"home",x:0,y:0,rateX:8,rateY:6}],this.homeBottom=[{type:"home",x:0,y:0,rateX:6,rateY:11},{type:"home",x:0,y:0,rateX:6,rateY:10},{type:"home",x:0,y:0,rateX:6,rateY:9},{type:"home",x:0,y:0,rateX:6,rateY:8}],this.homeLeft=[{type:"home",x:0,y:0,rateX:1,rateY:6},{type:"home",x:0,y:0,rateX:2,rateY:6},{type:"home",x:0,y:0,rateX:3,rateY:6},{type:"home",x:0,y:0,rateX:4,rateY:6}],this.ceils=[{type:"corner",x:0,y:0,rateX:0,rateY:0},{type:"empty",x:0,y:0,rateX:1,rateY:0},{type:"empty",x:0,y:0,rateX:2,rateY:0},{type:"empty",x:0,y:0,rateX:3,rateY:0},{type:"port",target:44,x:0,y:0,rateX:4,rateY:0},{type:"empty",x:0,y:0,rateX:5,rateY:0},{type:"home",target:"HomeTop",x:0,y:0,rateX:6,rateY:0},{type:"empty",x:0,y:0,rateX:7,rateY:0},{type:"port",target:16,x:0,y:0,rateX:8,rateY:0},{type:"toilet",target:"toiletTop",x:0,y:0,rateX:9,rateY:0},{type:"empty",x:0,y:0,rateX:10,rateY:0},{type:"exit",target:"toiletTop",x:0,y:0,rateX:11,rateY:0},{type:"corner",x:0,y:0,rateX:12,rateY:0},{type:"empty",x:0,y:0,rateX:12,rateY:1},{type:"empty",x:0,y:0,rateX:12,rateY:2},{type:"empty",x:0,y:0,rateX:12,rateY:3},{type:"port",target:8,x:0,y:0,rateX:12,rateY:4},{type:"empty",x:0,y:0,rateX:12,rateY:5},{type:"home",target:"HomeRight",x:0,y:0,rateX:12,rateY:6},{type:"empty",x:0,y:0,rateX:12,rateY:7},{type:"port",target:28,x:0,y:0,rateX:12,rateY:8},{type:"toilet",target:"toiletRight",x:0,y:0,rateX:12,rateY:9},{type:"empty",x:0,y:0,rateX:12,rateY:10},{type:"exit",target:"toiletRight",x:0,y:0,rateX:12,rateY:11},{type:"corner",x:0,y:0,rateX:12,rateY:12},{type:"empty",x:0,y:0,rateX:11,rateY:12},{type:"empty",x:0,y:0,rateX:10,rateY:12},{type:"empty",x:0,y:0,rateX:9,rateY:12},{type:"port",target:20,x:0,y:0,rateX:8,rateY:12},{type:"empty",x:0,y:0,rateX:7,rateY:12},{type:"home",target:"HomeBottom",x:0,y:0,rateX:6,rateY:12},{type:"empty",x:0,y:0,rateX:5,rateY:12},{type:"port",target:40,x:0,y:0,rateX:4,rateY:12},{type:"toilet",target:"toiletBottom",x:0,y:0,rateX:3,rateY:12},{type:"empty",x:0,y:0,rateX:2,rateY:12},{type:"exit",target:"toiletBottom",x:0,y:0,rateX:1,rateY:12},{type:"corner",x:0,y:0,rateX:0,rateY:12},{type:"empty",x:0,y:0,rateX:0,rateY:11},{type:"empty",x:0,y:0,rateX:0,rateY:10},{type:"empty",x:0,y:0,rateX:0,rateY:9},{type:"port",target:32,x:0,y:0,rateX:0,rateY:8},{type:"empty",x:0,y:0,rateX:0,rateY:7},{type:"home",target:"HomeLeft",x:0,y:0,rateX:0,rateY:6},{type:"empty",x:0,y:0,rateX:0,rateY:5},{type:"port",target:4,x:0,y:0,rateX:0,rateY:4},{type:"toilet",target:"toiletLeft",x:0,y:0,rateX:0,rateY:3},{type:"empty",x:0,y:0,rateX:0,rateY:2},{type:"exit",target:"toiletLeft",x:0,y:0,rateX:0,rateY:1}],this.resize(),o.resizeDependenceArray.push(this)}getHalfCeilSize(){return o.width>o.height?Math.floor(o.height/26):Math.floor(o.width/26)}resize(){this.halfCeilSize=this.getHalfCeilSize(),this.ceilSize=this.halfCeilSize>60?120:2*this.halfCeilSize,this.size=13*this.ceilSize,this.offsetX=Math.floor((o.width-this.size)/2),this.offsetY=Math.floor((o.height-this.size)/2),this.recalculateCeilsPositions([this.toiletTop,this.toiletRight,this.toiletBottom,this.toiletLeft,this.homeTop,this.toiletRight,this.toiletBottom,this.toiletLeft,this.ceils])}recalculateCeilsPositions(t){const e=this.offsetX+this.halfCeilSize,i=this.offsetY+this.halfCeilSize;t.forEach((t=>{t.forEach((t=>{t.x=e+this.ceilSize*t.rateX,t.y=i+this.ceilSize*t.rateY}))}))}update(){o.context.drawImage(this.image,this.offsetX,this.offsetY,this.size,this.size)}},i=new y(-21,-21),s=new y(21,21),h=(new p("dices",1,[i,s]),new m(i)),a=new m(s);g=new p("dicePointers",2),d.push(new l(t.tokenColor,0,e,Y)),d.push(new l(t.tokenBlack,1,e,Y)),d.push(new l(t.tokenYellow,2,e,Y)),d.push(new l(t.tokenRed,3,e,Y));const r=new p("tokens",3,d);d[0].stepDuration,x=Math.floor(Math.random()*d.length),r.remove(d[x]),r.add(d[x]),f=!0;const n=[new c(e.ceils[6],e,!0),new c(e.ceils[18],e,!1)];new p("pointers",4,n),document.body.onclick=function(){if(!f)return;let t,e;r.remove(d[x]),r.add(d[x]),f=!1,t=i.throw(),e=s.throw(),z=t>e?[{pointer:h,steps:t},{pointer:a,steps:e}]:[{pointer:a,steps:e},{pointer:h,steps:t}],u=t===e,setTimeout(Y,1500)}}()}}();let x,f=!1;const d=[];let g,z=[],u=!1;function Y(){if(g.clear(),z.length){const{pointer:t,steps:e}=z.shift();g.add(t),d[x].move(e)}else u||(x++,x===d.length&&(x=0)),f=!0}})();